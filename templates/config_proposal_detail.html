{% extends 'base.html' %}
{% block title %}Chi tiết đề xuất{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Chi tiết đề xuất</h3>
  <a class="btn btn-secondary" href="{{ url_for('config_proposals') }}">Quay lại</a>
</div>

<div class="card mb-3">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-6"><strong>Tên đề xuất:</strong> {{ p.name }}</div>
      <div class="col-md-3"><strong>Ngày đề xuất:</strong> {{ p.proposal_date.strftime('%d-%m-%Y') }}</div>
      <div class="col-md-3"><strong>Phạm vi:</strong> {{ p.scope }}</div>
      <div class="col-md-6"><strong>Người đề xuất:</strong> {{ p.proposer_name }}</div>
      <div class="col-md-6"><strong>Đơn vị:</strong> {{ p.proposer_unit }}</div>
      <div class="col-md-12"><strong>Nhà cung cấp:</strong> {{ p.supplier_info or '' }}</div>
      <div class="col-md-3"><strong>Loại tiền:</strong> {{ p.currency }}</div>
      <div class="col-md-3"><strong>Trạng thái:</strong> {{ p.status }}</div>
      <div class="col-md-6"><strong>TT mua hàng:</strong> {{ p.purchase_status }}</div>
      <div class="col-12"><strong>Ghi chú:</strong> {{ p.notes or '' }}</div>
      <div class="col-md-6">
        <strong>Phiếu nhập kho:</strong>
        {% if p.linked_receipt_id %}
        <a href="{{ url_for('inventory_receipt_detail', receipt_id=p.linked_receipt_id) }}">#{{ p.linked_receipt_id
          }}</a>
        {% else %}
        Chưa gán
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:70px">STT</th>
            <th>Tên sản phẩm</th>
            <th style="width:140px">Bảo hành</th>
            <th class="text-end" style="width:120px">Số lượng</th>
            <th class="text-end" style="width:160px">Đơn giá</th>
            <th class="text-end" style="width:180px">Thành tiền</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
          <tr>
            <td class="text-center">{{ it.order_no }}</td>
            <td>
              {% if it.product_link %}
              <a href="{{ it.product_link }}" target="_blank">{{ it.product_name }}</a>
              {% else %}
              {{ it.product_name }}
              {% endif %}
            </td>
            <td>{{ it.warranty }}</td>
            <td class="text-end">{{ it.quantity }}</td>
            <td class="text-end">{{ '%.0f'|format(it.unit_price or 0) }}</td>
            <td class="text-end">{{ '%.0f'|format(it.line_total or 0) }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="text-center text-muted">Không có dòng nào.</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="5" class="text-end fw-semibold">Tổng tạm tính</td>
            <td class="text-end">{{ (p.subtotal or 0)|vnd }}</td>
          </tr>
          <tr>
            <td colspan="5" class="text-end fw-semibold">Số lượng (Bộ)</td>
            <td class="text-end">{{ p.quantity }}</td>
          </tr>
          <tr>
            <td colspan="5" class="text-end fw-semibold">VAT ({{ '%.2f'|format(p.vat_percent) }}%)</td>
            <td class="text-end">{{ (p.vat_amount or 0)|vnd }}</td>
          </tr>
          <tr>
            <td colspan="5" class="text-end fw-bold">Tổng cộng</td>
            <td class="text-end fw-bold">{{ (p.total_amount or 0)|vnd }} {{ p.currency }}</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
{% endblock %}