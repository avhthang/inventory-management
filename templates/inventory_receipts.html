{% extends "base.html" %}

{% from '_pagination.html' import render_pagination %}

{% block title %}Phiếu nhập kho{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="card-title mb-0">Phiếu nhập kho</h2>
            <div class="d-flex gap-2">
                <a href="{{ url_for('add_devices_bulk') }}" class="btn btn-primary"><i class="bi bi-plus-square"></i> Tạo phiếu nhập kho</a>
                <a href="{{ url_for('inventory_receipt_export_mof', receipt_id=0) }}" class="btn btn-success"><i class="bi bi-file-earmark-text"></i> Tạo phiếu nhập kho (mẫu BTC)</a>
            </div>
        </div>
        
        <div class="d-flex gap-2 mb-3">
            <span class="text-muted">Sắp xếp theo:</span>
            <a href="{{ url_for('inventory_receipts', sort='date_desc') }}" class="btn btn-sm {% if sort_by == 'date_desc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Ngày nhập (mới nhất)</a>
            <a href="{{ url_for('inventory_receipts', sort='date_asc') }}" class="btn btn-sm {% if sort_by == 'date_asc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Ngày nhập (cũ nhất)</a>
            <a href="{{ url_for('inventory_receipts', sort='code_desc') }}" class="btn btn-sm {% if sort_by == 'code_desc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Mã phiếu (Z-A)</a>
            <a href="{{ url_for('inventory_receipts', sort='code_asc') }}" class="btn btn-sm {% if sort_by == 'code_asc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Mã phiếu (A-Z)</a>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Mã phiếu</th>
                        <th>Ngày nhập</th>
                        <th>Nhà cung cấp</th>
                        <th>Người nhập</th>
                        <th>Ghi chú</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in receipts.items %}
                    <tr>
                        <td>{{ loop.index + receipts.per_page * (receipts.page - 1) }}</td>
                        <td><a href="{{ url_for('inventory_receipt_detail', receipt_id=r.id) }}"><strong>{{ r.code }}</strong></a></td>
                        <td>{{ r.date.strftime('%d-%m-%Y') if r.date else '' }}</td>
                        <td>{{ r.supplier or '' }}</td>
                        <td>{{ r.importer or '' }}</td>
                        <td>{{ r.notes or '' }}</td>
                        <td class="text-end text-nowrap">
                            <a href="{{ url_for('inventory_receipt_detail', receipt_id=r.id) }}" class="btn btn-sm btn-outline-info">Xem</a>
                            <a href="{{ url_for('inventory_receipt_edit', receipt_id=r.id) }}" class="btn btn-sm btn-outline-warning ms-1">Sửa</a>
                            <form method="POST" action="{{ url_for('inventory_receipt_delete', receipt_id=r.id) }}" class="d-inline" onsubmit="return confirm('Xóa phiếu này?')">
                                <button class="btn btn-sm btn-outline-danger ms-1">Xóa</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {{ render_pagination(receipts, 'inventory_receipts') }}
        </div>
    </div>
</div>
{% endblock %}
