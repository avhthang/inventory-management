{% extends "base.html" %}

{% from '_pagination.html' import render_pagination %}

{% block title %}Phiếu nhập kho{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="card-title mb-0">Phiếu nhập kho</h2>
            <div class="d-flex gap-2">
                <a href="{{ url_for('add_devices_bulk') }}" class="btn btn-primary"><i class="bi bi-plus-square"></i> Tạo phiếu nhập kho</a>
                {# Ẩn nút tạo phiếu nhập kho (mẫu BTC) theo yêu cầu #}
                {# <a href="{{ url_for('inventory_receipt_export_mof', receipt_id=0) }}" class="btn btn-success"><i class="bi bi-file-earmark-text"></i> Tạo phiếu nhập kho (mẫu BTC)</a> #}
            </div>
        </div>

        <!-- Bộ lọc -->
        <div class="card mb-3">
            <div class="card-body">
                <form method="GET" class="row g-3 align-items-end">
                    <input type="hidden" name="sort" value="{{ sort_by }}">
                    
                    <div class="col-md-4">
                        <label class="form-label">Nhà cung cấp</label>
                        <select name="filter_supplier" class="form-select">
                            <option value="">-- Tất cả --</option>
                            {% for supplier in suppliers %}
                            <option value="{{ supplier }}" {% if filter_supplier == supplier %}selected{% endif %}>{{ supplier }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">Từ ngày</label>
                        <input type="date" class="form-control" name="date_from" value="{{ date_from }}">
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">Đến ngày</label>
                        <input type="date" class="form-control" name="date_to" value="{{ date_to }}">
                    </div>

                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-funnel"></i> Lọc
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="d-flex gap-2 mb-3">
            <span class="text-muted">Sắp xếp theo:</span>
            <a href="{{ url_for('inventory_receipts', sort='date_desc') }}" class="btn btn-sm {% if sort_by == 'date_desc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Ngày nhập (mới nhất)</a>
            <a href="{{ url_for('inventory_receipts', sort='date_asc') }}" class="btn btn-sm {% if sort_by == 'date_asc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Ngày nhập (cũ nhất)</a>
            <a href="{{ url_for('inventory_receipts', sort='code_desc') }}" class="btn btn-sm {% if sort_by == 'code_desc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Mã phiếu (Z-A)</a>
            <a href="{{ url_for('inventory_receipts', sort='code_asc') }}" class="btn btn-sm {% if sort_by == 'code_asc' %}btn-primary{% else %}btn-outline-primary{% endif %}">Mã phiếu (A-Z)</a>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Mã phiếu</th>
                        <th>Ngày nhập</th>
                        <th>Nhà cung cấp</th>
                        <th>Người nhập</th>
                        <th>Ghi chú</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in receipts.items %}
                    <tr>
                        <td>{{ loop.index + receipts.per_page * (receipts.page - 1) }}</td>
                        <td><a href="{{ url_for('inventory_receipt_detail', receipt_id=r.id) }}"><strong>{{ r.code }}</strong></a></td>
                        <td>{{ r.date.strftime('%d-%m-%Y') if r.date else '' }}</td>
                        <td>{{ r.supplier or '' }}</td>
                        <td>{{ r.importer or '' }}</td>
                        <td>{{ r.notes or '' }}</td>
                        <td class="text-end text-nowrap">
                            <a href="{{ url_for('inventory_receipt_detail', receipt_id=r.id) }}" class="btn btn-sm btn-outline-info">Xem</a>
                            <a href="{{ url_for('inventory_receipt_edit', receipt_id=r.id) }}" class="btn btn-sm btn-outline-warning ms-1">Sửa</a>
                            <form method="POST" action="{{ url_for('inventory_receipt_delete', receipt_id=r.id) }}" class="d-inline" onsubmit="return confirm('Xóa phiếu này?')">
                                <button class="btn btn-sm btn-outline-danger ms-1">Xóa</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% set pagination_args = {'sort': sort_by, 'filter_supplier': filter_supplier, 'date_from': date_from, 'date_to': date_to} %}
            {{ render_pagination(receipts, 'inventory_receipts', pagination_args) }}
        </div>
    </div>
</div>
{% endblock %}
