{% extends "base.html" %}
{% from '_pagination.html' import render_pagination %}
{% block title %}Danh sách Thiết Bị{% endblock %}
{% block content %}

    
        
            Danh sách Thiết Bị

            <a href="{{ url_for('add_device') }}" class="btn btn-primary">+ Thêm thiết bị</a>
            <a href="{{ url_for('import_devices') }}" class="btn btn-primary">Nhập từ Excel</a>
            <a href="{{ url_for('export_devices_excel') }}" class="btn btn-success">Xuất Excel</a>
        

        

        
            
                <input type="text" name="filter_device_code" value="{{ filter_device_code }}" placeholder="Mã thiết bị">
                <input type="text" name="filter_name" value="{{ filter_name }}" placeholder="Tên thiết bị">
                <select name="filter_device_type">
                    <option value="">-- Tất cả --</option>
                    {% for type in device_types %}
                        <option value="{{ type }}" {% if type == filter_device_type %}selected{% endif %}>{{ type }}</option>
                    {% endfor %}
                </select>
                <select name="filter_status">
                    <option value="">-- Tất cả --</option>
                    {% for status in statuses %}
                        <option value="{{ status }}" {% if status == filter_status %}selected{% endif %}>{{ status }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary">Tìm kiếm</button>
                <a href="{{ url_for('device_list') }}" class="btn btn-secondary">Reset</a>
            

        

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Mã thiết bị</th>
                    <th>Tên thiết bị</th>
                    <th>Loại thiết bị</th>
                    <th>Tình trạng</th>
                    <th>Trạng thái</th>
                    <th>Người quản lý</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                {% for device in devices.items %}
                <tr>
                    <td>{{ devices.first + loop.index - 1 }}</td>
                    <td>{{ device.device_code }}</td>
                    <td>{{ device.name }}</td>
                    <td>{{ device.device_type }}</td>
                    <td>{{ device.condition }}</td>
                    <td>{{ device.status }}</td>
                    <td>{{ device.manager.full_name if device.manager else '' }}</td>
                    <td>
                        <a href="{{ url_for('device_detail', device_id=device.id) }}" class="btn btn-info btn-sm">Chi tiết</a>
                        <a href="{{ url_for('edit_device', device_id=device.id) }}" class="btn btn-warning btn-sm">Sửa</a>
                        <form action="{{ url_for('delete_device', device_id=device.id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Bạn có chắc muốn xóa thiết bị này?');">Xóa</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% set filters = {'filter_device_code': filter_device_code, 'filter_name': filter_name, 'filter_device_type': filter_device_type, 'filter_status': filter_status} %}
        {{ render_pagination(devices, 'device_list', filters=filters) }}
    



{% endblock %}