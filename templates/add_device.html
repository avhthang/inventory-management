{% extends "base.html" %}

{% block title %}Thêm Thiết Bị Mới{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <h2 class="card-title">Thêm Thiết Bị Mới</h2>
        <form method="POST">
            <div class="row">
                <!-- Cột 1: Thông tin thiết bị (Technical) -->
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Thông tin kỹ thuật</h5>
                        </div>
                        <div class="card-body">
                            <div class="form-group mb-3">
                                <label class="form-label required">Mã thiết bị</label>
                                <input type="text" name="device_code" class="form-control"
                                    placeholder="Để trống để tự động tạo mã">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label required">Tên thiết bị</label>
                                <input type="text" name="name" class="form-control"
                                    placeholder="VD: Laptop Dell Vostro 3550" required>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label required">Loại thiết bị</label>
                                <select name="device_type" class="form-control" required>
                                    <option value="">-- Chọn loại --</option>
                                    {% if grouped_device_types %}
                                    {% for category, types in grouped_device_types.items() %}
                                    <optgroup label="{{ category }}">
                                        {% for type in types %}
                                        <option value="{{ type.name }}">{{ type.name }}</option>
                                        {% endfor %}
                                    </optgroup>
                                    {% endfor %}
                                    {% else %}
                                    <!-- Fallback if no types in DB -->
                                    <option value="Laptop">Laptop</option>
                                    <option value="Case máy tính">Case máy tính</option>
                                    <option value="Màn hình">Màn hình</option>
                                    {% endif %}
                                </select>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Số serial</label>
                                <input type="text" name="serial_number" class="form-control">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Thương hiệu</label>
                                <input type="text" name="brand" class="form-control" placeholder="VD: Dell, HP, Apple">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Bảo hành</label>
                                <input type="text" name="warranty" class="form-control" placeholder="VD: 12 tháng">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Cấu hình chi tiết</label>
                                <textarea name="configuration" class="form-control" rows="3"
                                    placeholder="VD: CPU i5, RAM 8GB, SSD 256GB"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cột 2: Thông tin mua sắm & Bàn giao -->
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Thông tin mua sắm & Quản lý</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label class="form-label required">Ngày mua</label>
                                        <input type="date" name="purchase_date" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label class="form-label">Giá mua (VND)</label>
                                        <input type="number" step="1000" name="purchase_price" class="form-control"
                                            placeholder="VD: 15000000">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group mb-3">
                                <label class="form-label">Nhà cung cấp</label>
                                <input type="text" name="supplier" class="form-control" placeholder="VD: FPT, Phong Vũ">
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label class="form-label">Người mua</label>
                                        <input type="text" name="buyer" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label class="form-label">Người nhập kho</label>
                                        <input type="text" name="importer" class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group mb-3">
                                <label class="form-label required">Ngày nhập kho</label>
                                <input type="date" name="import_date" class="form-control" required>
                            </div>

                            <div class="form-group mb-3">
                                <label class="form-label required">Tình trạng ban đầu</label>
                                <select name="condition" class="form-control" required>
                                    <option value="Mới">Mới</option>
                                    <option value="Sử dụng bình thường" selected>Sử dụng bình thường</option>
                                    <option value="Cần bảo trì">Cần bảo trì</option>
                                    <option value="Hỏng">Hỏng</option>
                                </select>
                            </div>

                            <div class="form-group mb-3">
                                <label class="form-label">Người quản lý ban đầu</label>
                                <select name="manager_id" class="form-control">
                                    <option value="">-- Chọn --</option>
                                    {% for manager in managers %}<option value="{{ manager.id }}">{{ manager.full_name
                                        }}
                                    </option>{% endfor %}
                                </select>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Ngày cấp phát ban đầu</label>
                                <input type="date" name="assign_date" class="form-control">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Ghi chú</label>
                                <textarea name="notes" class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group mt-3">
                <a href="{{ url_for('device_list') }}" class="btn btn-secondary">Hủy bỏ</a>
                <button type="submit" class="btn btn-primary">Thêm thiết bị</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}